<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# courier

```go
import "github.com/gojek/courier-go"
```

Package courier contains the client that can be used to interact with the courier infrastructure to publish/subscribe to messages from other clients

## Index

- [Variables](#variables)
- [func ExponentialStartStrategy\(ctx context.Context, c interface\{ Start\(\) error \}, opts ...StartOption\)](#ExponentialStartStrategy)
- [func Version\(\) string](#Version)
- [func WaitForConnection\(c ConnectionInformer, waitFor time.Duration, tick time.Duration\) bool](#WaitForConnection)
- [type Client](#Client)
  - [func NewClient\(opts ...ClientOption\) \(\*Client, error\)](#NewClient)
  - [func \(c \*Client\) InfoHandler\(\) http.Handler](#Client.InfoHandler)
  - [func \(c \*Client\) IsConnected\(\) bool](#Client.IsConnected)
  - [func \(c \*Client\) Publish\(ctx context.Context, topic string, message interface\{\}, opts ...Option\) error](#Client.Publish)
  - [func \(c \*Client\) Run\(ctx context.Context\) error](#Client.Run)
  - [func \(c \*Client\) Start\(\) error](#Client.Start)
  - [func \(c \*Client\) Stop\(\)](#Client.Stop)
  - [func \(c \*Client\) Subscribe\(ctx context.Context, topic string, callback MessageHandler, opts ...Option\) error](#Client.Subscribe)
  - [func \(c \*Client\) SubscribeMultiple\(ctx context.Context, topicsWithQos map\[string\]QOSLevel, callback MessageHandler\) error](#Client.SubscribeMultiple)
  - [func \(c \*Client\) Unsubscribe\(ctx context.Context, topics ...string\) error](#Client.Unsubscribe)
  - [func \(c \*Client\) UsePublisherMiddleware\(mwf ...PublisherMiddlewareFunc\)](#Client.UsePublisherMiddleware)
  - [func \(c \*Client\) UseSubscriberMiddleware\(mwf ...SubscriberMiddlewareFunc\)](#Client.UseSubscriberMiddleware)
  - [func \(c \*Client\) UseUnsubscriberMiddleware\(mwf ...UnsubscriberMiddlewareFunc\)](#Client.UseUnsubscriberMiddleware)
- [type ClientInfoEmitter](#ClientInfoEmitter)
- [type ClientInfoEmitterConfig](#ClientInfoEmitterConfig)
- [type ClientMeta](#ClientMeta)
- [type ClientOption](#ClientOption)
  - [func WithAddress\(host string, port uint16\) ClientOption](#WithAddress)
  - [func WithAutoReconnect\(autoReconnect bool\) ClientOption](#WithAutoReconnect)
  - [func WithCleanSession\(cleanSession bool\) ClientOption](#WithCleanSession)
  - [func WithClientID\(clientID string\) ClientOption](#WithClientID)
  - [func WithConnectTimeout\(duration time.Duration\) ClientOption](#WithConnectTimeout)
  - [func WithCredentialFetcher\(fetcher CredentialFetcher\) ClientOption](#WithCredentialFetcher)
  - [func WithCustomDecoder\(decoderFunc DecoderFunc\) ClientOption](#WithCustomDecoder)
  - [func WithCustomEncoder\(encoderFunc EncoderFunc\) ClientOption](#WithCustomEncoder)
  - [func WithExponentialStartOptions\(options ...StartOption\) ClientOption](#WithExponentialStartOptions)
  - [func WithGracefulShutdownPeriod\(duration time.Duration\) ClientOption](#WithGracefulShutdownPeriod)
  - [func WithKeepAlive\(duration time.Duration\) ClientOption](#WithKeepAlive)
  - [func WithLogger\(l Logger\) ClientOption](#WithLogger)
  - [func WithMaintainOrder\(maintainOrder bool\) ClientOption](#WithMaintainOrder)
  - [func WithMaxReconnectInterval\(duration time.Duration\) ClientOption](#WithMaxReconnectInterval)
  - [func WithOnConnect\(handler OnConnectHandler\) ClientOption](#WithOnConnect)
  - [func WithOnConnectionLost\(handler OnConnectionLostHandler\) ClientOption](#WithOnConnectionLost)
  - [func WithOnReconnect\(handler OnReconnectHandler\) ClientOption](#WithOnReconnect)
  - [func WithPahoLogLevel\(level LogLevel\) ClientOption](#WithPahoLogLevel)
  - [func WithPassword\(password string\) ClientOption](#WithPassword)
  - [func WithPersistence\(store Store\) ClientOption](#WithPersistence)
  - [func WithResolver\(resolver Resolver\) ClientOption](#WithResolver)
  - [func WithTCPAddress\(host string, port uint16\) ClientOption](#WithTCPAddress)
  - [func WithTLS\(tlsConfig \*tls.Config\) ClientOption](#WithTLS)
  - [func WithUseBase64Decoder\(\) ClientOption](#WithUseBase64Decoder)
  - [func WithUsername\(username string\) ClientOption](#WithUsername)
  - [func WithWriteTimeout\(duration time.Duration\) ClientOption](#WithWriteTimeout)
- [type ConnectRetryInterval](#ConnectRetryInterval)
- [type ConnectionInformer](#ConnectionInformer)
- [type Credential](#Credential)
- [type CredentialFetcher](#CredentialFetcher)
- [type Decoder](#Decoder)
  - [func DefaultDecoderFunc\(\_ context.Context, r io.Reader\) Decoder](#DefaultDecoderFunc)
- [type DecoderFunc](#DecoderFunc)
- [type Encoder](#Encoder)
  - [func DefaultEncoderFunc\(\_ context.Context, w io.Writer\) Encoder](#DefaultEncoderFunc)
- [type EncoderFunc](#EncoderFunc)
- [type KeepAlive](#KeepAlive)
- [type LogLevel](#LogLevel)
- [type Logger](#Logger)
- [type MQTTClientInfo](#MQTTClientInfo)
- [type Message](#Message)
  - [func NewMessageWithDecoder\(payloadDecoder Decoder\) \*Message](#NewMessageWithDecoder)
  - [func \(m \*Message\) DecodePayload\(v interface\{\}\) error](#Message.DecodePayload)
- [type MessageHandler](#MessageHandler)
- [type OnConnectHandler](#OnConnectHandler)
- [type OnConnectionLostHandler](#OnConnectionLostHandler)
- [type OnReconnectHandler](#OnReconnectHandler)
- [type Option](#Option)
- [type PubSub](#PubSub)
- [type Publisher](#Publisher)
- [type PublisherFunc](#PublisherFunc)
  - [func \(f PublisherFunc\) Publish\(ctx context.Context, topic string, message interface\{\}, opts ...Option\) error](#PublisherFunc.Publish)
- [type PublisherMiddlewareFunc](#PublisherMiddlewareFunc)
  - [func \(pmw PublisherMiddlewareFunc\) Middleware\(publisher Publisher\) Publisher](#PublisherMiddlewareFunc.Middleware)
- [type QOSLevel](#QOSLevel)
- [type Resolver](#Resolver)
- [type Retained](#Retained)
- [type SharedSubscriptionPredicate](#SharedSubscriptionPredicate)
- [type StartOption](#StartOption)
  - [func WithMaxInterval\(interval time.Duration\) StartOption](#WithMaxInterval)
  - [func WithOnRetry\(retryFunc func\(error\)\) StartOption](#WithOnRetry)
- [type Store](#Store)
  - [func NewMemoryStore\(\) Store](#NewMemoryStore)
- [type Subscriber](#Subscriber)
- [type SubscriberFuncs](#SubscriberFuncs)
  - [func NewSubscriberFuncs\(subscribeFunc func\(context.Context, string, MessageHandler, ...Option\) error, subscribeMultipleFunc func\(context.Context, map\[string\]QOSLevel, MessageHandler\) error\) SubscriberFuncs](#NewSubscriberFuncs)
  - [func \(s SubscriberFuncs\) Subscribe\(ctx context.Context, topic string, callback MessageHandler, opts ...Option\) error](#SubscriberFuncs.Subscribe)
  - [func \(s SubscriberFuncs\) SubscribeMultiple\(ctx context.Context, topicsWithQos map\[string\]QOSLevel, callback MessageHandler\) error](#SubscriberFuncs.SubscribeMultiple)
- [type SubscriberMiddlewareFunc](#SubscriberMiddlewareFunc)
  - [func \(smw SubscriberMiddlewareFunc\) Middleware\(subscriber Subscriber\) Subscriber](#SubscriberMiddlewareFunc.Middleware)
- [type TCPAddress](#TCPAddress)
  - [func \(t TCPAddress\) String\(\) string](#TCPAddress.String)
- [type Unsubscriber](#Unsubscriber)
- [type UnsubscriberFunc](#UnsubscriberFunc)
  - [func \(f UnsubscriberFunc\) Unsubscribe\(ctx context.Context, topics ...string\) error](#UnsubscriberFunc.Unsubscribe)
- [type UnsubscriberMiddlewareFunc](#UnsubscriberMiddlewareFunc)
  - [func \(usmw UnsubscriberMiddlewareFunc\) Middleware\(unsubscriber Unsubscriber\) Unsubscriber](#UnsubscriberMiddlewareFunc.Middleware)


## Variables

<a name="ErrConnectTimeout"></a>

```go
var (
    // ErrConnectTimeout indicates connection timeout while connecting to broker.
    ErrConnectTimeout = errors.New("client timed out while trying to connect to the broker")
    // ErrPublishTimeout indicates publish timeout.
    ErrPublishTimeout = errors.New("publish timeout")
    // ErrSubscribeTimeout indicates subscribe timeout.
    ErrSubscribeTimeout = errors.New("subscribe timeout")
    // ErrUnsubscribeTimeout indicates unsubscribe timeout.
    ErrUnsubscribeTimeout = errors.New("unsubscribe timeout")
    // ErrSubscribeMultipleTimeout indicates multiple subscribe timeout.
    ErrSubscribeMultipleTimeout = errors.New("subscribe multiple timeout")
)
```

<a name="ErrClientNotInitialized"></a>ErrClientNotInitialized is returned when the client is not initialized

```go
var ErrClientNotInitialized = errors.New("courier: client not initialized")
```

<a name="ResumeSubscriptions"></a>ResumeSubscriptions allows resuming of stored \(un\)subscribe messages when connecting but not reconnecting if CleanSession is false. Otherwise, these messages are discarded.

```go
var ResumeSubscriptions = resumeSubscriptions{}
```

<a name="UseMultiConnectionMode"></a>UseMultiConnectionMode allows to configure the client to use multiple connections when available.

This is useful when working with shared subscriptions and multiple connections can be created to subscribe on the same application.

```go
var UseMultiConnectionMode = multiConnMode{}
```

<a name="ExponentialStartStrategy"></a>
## func [ExponentialStartStrategy](https://github.com/gojek/courier-go/blob/main/exp_starter.go#L32)

```go
func ExponentialStartStrategy(ctx context.Context, c interface{ Start() error }, opts ...StartOption)
```

ExponentialStartStrategy will keep attempting to call Client.Start in the background and retry on error, it will never exit unless the context used to invoke is cancelled. This will NOT stop the client, that is the responsibility of caller.

<a name="Version"></a>
## func [Version](https://github.com/gojek/courier-go/blob/main/version.go#L4)

```go
func Version() string
```

Version can be used to get the current courier library version

<a name="WaitForConnection"></a>
## func [WaitForConnection](https://github.com/gojek/courier-go/blob/main/utils.go#L10)

```go
func WaitForConnection(c ConnectionInformer, waitFor time.Duration, tick time.Duration) bool
```

WaitForConnection checks if the Client is connected, it calls ConnectionInformer.IsConnected after every tick and waitFor is the maximum duration it can block. Returns true only when ConnectionInformer.IsConnected returns true

<a name="Client"></a>
## type [Client](https://github.com/gojek/courier-go/blob/main/client.go#L22-L43)

Client allows to communicate with an MQTT broker

```go
type Client struct {
    // contains filtered or unexported fields
}
```

<a name="NewClient"></a>
### func [NewClient](https://github.com/gojek/courier-go/blob/main/client.go#L48)

```go
func NewClient(opts ...ClientOption) (*Client, error)
```

NewClient creates the Client struct with the clientOptions provided, it can return error when prometheus.DefaultRegisterer has already been used to register the collected metrics

<details><summary>Example</summary>
<p>



```go
c, err := courier.NewClient(
	courier.WithUsername("username"),
	courier.WithPassword("password"),
	courier.WithAddress("localhost", 1883),
)

if err != nil {
	panic(err)
}

if err := c.Start(); err != nil {
	panic(err)
}

stopCh := make(chan os.Signal, 1)
signal.Notify(stopCh, []os.Signal{os.Interrupt, syscall.SIGTERM}...)

go func() {
	tick := time.NewTicker(time.Second)
	for {
		select {
		case t := <-tick.C:
			msg := map[string]interface{}{
				"time": t.UnixNano(),
			}
			if err := c.Publish(context.Background(), "topic", msg, courier.QOSOne); err != nil {
				fmt.Printf("Publish() error = %s\n", err)
			} else {
				fmt.Println("Publish() success")
			}
		case <-stopCh:
			tick.Stop()
			return
		}
	}
}()

<-stopCh
c.Stop()
```

</p>
</details>

<a name="Client.InfoHandler"></a>
### func \(\*Client\) [InfoHandler](https://github.com/gojek/courier-go/blob/main/http.go#L9)

```go
func (c *Client) InfoHandler() http.Handler
```

InfoHandler returns a http.Handler that exposes the connected clients information

<a name="Client.IsConnected"></a>
### func \(\*Client\) [IsConnected](https://github.com/gojek/courier-go/blob/main/client.go#L84)

```go
func (c *Client) IsConnected() bool
```

IsConnected checks whether the client is connected to the broker

<a name="Client.Publish"></a>
### func \(\*Client\) [Publish](https://github.com/gojek/courier-go/blob/main/client_publish.go#L11)

```go
func (c *Client) Publish(ctx context.Context, topic string, message interface{}, opts ...Option) error
```

Publish allows to publish messages to an MQTT broker

<a name="Client.Run"></a>
### func \(\*Client\) [Run](https://github.com/gojek/courier-go/blob/main/client.go#L114)

```go
func (c *Client) Run(ctx context.Context) error
```

Run will start running the Client. This makes Client compatible with github.com/gojekfarm/xrun package. https://pkg.go.dev/github.com/gojekfarm/xrun

<a name="Client.Start"></a>
### func \(\*Client\) [Start](https://github.com/gojek/courier-go/blob/main/client.go#L97)

```go
func (c *Client) Start() error
```

Start will attempt to connect to the broker.

<a name="Client.Stop"></a>
### func \(\*Client\) [Stop](https://github.com/gojek/courier-go/blob/main/client.go#L110)

```go
func (c *Client) Stop()
```

Stop will disconnect from the broker and finish up any pending work on internal communication workers. This can only block until the period configured with the ClientOption WithGracefulShutdownPeriod.

<a name="Client.Subscribe"></a>
### func \(\*Client\) [Subscribe](https://github.com/gojek/courier-go/blob/main/client_subscribe.go#L12)

```go
func (c *Client) Subscribe(ctx context.Context, topic string, callback MessageHandler, opts ...Option) error
```

Subscribe allows to subscribe to messages from an MQTT broker

<a name="Client.SubscribeMultiple"></a>
### func \(\*Client\) [SubscribeMultiple](https://github.com/gojek/courier-go/blob/main/client_subscribe.go#L29-L33)

```go
func (c *Client) SubscribeMultiple(ctx context.Context, topicsWithQos map[string]QOSLevel, callback MessageHandler) error
```

SubscribeMultiple allows to subscribe to messages on multiple topics from an MQTT broker

<a name="Client.Unsubscribe"></a>
### func \(\*Client\) [Unsubscribe](https://github.com/gojek/courier-go/blob/main/client_unsubscribe.go#L10)

```go
func (c *Client) Unsubscribe(ctx context.Context, topics ...string) error
```

Unsubscribe removes any subscription to messages from an MQTT broker

<a name="Client.UsePublisherMiddleware"></a>
### func \(\*Client\) [UsePublisherMiddleware](https://github.com/gojek/courier-go/blob/main/client_publish.go#L18)

```go
func (c *Client) UsePublisherMiddleware(mwf ...PublisherMiddlewareFunc)
```

UsePublisherMiddleware appends a PublisherMiddlewareFunc to the chain. Middleware can be used to intercept or otherwise modify, process or skip messages. They are executed in the order that they are applied to the Client.

<a name="Client.UseSubscriberMiddleware"></a>
### func \(\*Client\) [UseSubscriberMiddleware](https://github.com/gojek/courier-go/blob/main/client_subscribe.go#L56)

```go
func (c *Client) UseSubscriberMiddleware(mwf ...SubscriberMiddlewareFunc)
```

UseSubscriberMiddleware appends a SubscriberMiddlewareFunc to the chain. Middleware can be used to intercept or otherwise modify, process or skip subscriptions. They are executed in the order that they are applied to the Client.

<a name="Client.UseUnsubscriberMiddleware"></a>
### func \(\*Client\) [UseUnsubscriberMiddleware](https://github.com/gojek/courier-go/blob/main/client_unsubscribe.go#L27)

```go
func (c *Client) UseUnsubscriberMiddleware(mwf ...UnsubscriberMiddlewareFunc)
```

UseUnsubscriberMiddleware appends a UnsubscriberMiddlewareFunc to the chain. Middleware can be used to intercept or otherwise modify, process or skip subscriptions. They are executed in the order that they are applied to the Client.

<a name="ClientInfoEmitter"></a>
## type [ClientInfoEmitter](https://github.com/gojek/courier-go/blob/main/metrics.go#L17-L19)

ClientInfoEmitter emits broker info. This can be called concurrently, implementations should be concurrency safe.

```go
type ClientInfoEmitter interface {
    Emit(ctx context.Context, meta ClientMeta)
}
```

<a name="ClientInfoEmitterConfig"></a>
## type [ClientInfoEmitterConfig](https://github.com/gojek/courier-go/blob/main/metrics.go#L22-L26)

ClientInfoEmitterConfig is used to configure the broker info emitter.

```go
type ClientInfoEmitterConfig struct {
    // Interval is the interval at which the broker info emitter emits broker info.
    Interval time.Duration
    Emitter  ClientInfoEmitter
}
```

<a name="ClientMeta"></a>
## type [ClientMeta](https://github.com/gojek/courier-go/blob/main/metrics.go#L9-L13)

ClientMeta contains information about the internal MQTT client\(s\)

```go
type ClientMeta struct {
    MultiConnMode bool
    Clients       []MQTTClientInfo
    Subscriptions map[string]QOSLevel
}
```

<a name="ClientOption"></a>
## type [ClientOption](https://github.com/gojek/courier-go/blob/main/client_options.go#L19)

ClientOption allows to configure the behaviour of a Client.

```go
type ClientOption interface {
    // contains filtered or unexported methods
}
```

<a name="WithAddress"></a>
### func [WithAddress](https://github.com/gojek/courier-go/blob/main/client_options.go#L122)

```go
func WithAddress(host string, port uint16) ClientOption
```

WithAddress sets the broker address to be used. To establish a TLS connection, use WithTLS Option along with this. Default values for hostname is "127.0.0.1" and for port is 1883.

<a name="WithAutoReconnect"></a>
### func [WithAutoReconnect](https://github.com/gojek/courier-go/blob/main/client_options.go#L52)

```go
func WithAutoReconnect(autoReconnect bool) ClientOption
```

WithAutoReconnect sets whether the automatic reconnection logic should be used when the connection is lost, even if disabled the WithOnConnectionLost is still called.

<a name="WithCleanSession"></a>
### func [WithCleanSession](https://github.com/gojek/courier-go/blob/main/client_options.go#L64)

```go
func WithCleanSession(cleanSession bool) ClientOption
```

WithCleanSession will set the "clean session" flag in the connect message when this client connects to an MQTT broker. By setting this flag, you are indicating that no messages saved by the broker for this client should be delivered. Any messages that were going to be sent by this client before disconnecting but didn't, will not be sent upon connecting to the broker.

<a name="WithClientID"></a>
### func [WithClientID](https://github.com/gojek/courier-go/blob/main/client_options.go#L23)

```go
func WithClientID(clientID string) ClientOption
```

WithClientID sets the clientID to be used while connecting to an MQTT broker. According to the MQTT v3.1 specification, a client id must be no longer than 23 characters.

<a name="WithConnectTimeout"></a>
### func [WithConnectTimeout](https://github.com/gojek/courier-go/blob/main/client_options.go#L153)

```go
func WithConnectTimeout(duration time.Duration) ClientOption
```

WithConnectTimeout limits how long the client will wait when trying to open a connection to an MQTT server before timing out. A duration of 0 never times out. Default 15 seconds.

<a name="WithCredentialFetcher"></a>
### func [WithCredentialFetcher](https://github.com/gojek/courier-go/blob/main/client_credentials.go#L17)

```go
func WithCredentialFetcher(fetcher CredentialFetcher) ClientOption
```

WithCredentialFetcher sets the specified CredentialFetcher.

<a name="WithCustomDecoder"></a>
### func [WithCustomDecoder](https://github.com/gojek/courier-go/blob/main/client_options.go#L195)

```go
func WithCustomDecoder(decoderFunc DecoderFunc) ClientOption
```

WithCustomDecoder allows to decode message bytes into the desired object.

<a name="WithCustomEncoder"></a>
### func [WithCustomEncoder](https://github.com/gojek/courier-go/blob/main/client_options.go#L192)

```go
func WithCustomEncoder(encoderFunc EncoderFunc) ClientOption
```

WithCustomEncoder allows to transform objects into the desired message bytes.

<a name="WithExponentialStartOptions"></a>
### func [WithExponentialStartOptions](https://github.com/gojek/courier-go/blob/main/client_options.go#L207)

```go
func WithExponentialStartOptions(options ...StartOption) ClientOption
```

WithExponentialStartOptions configures the client to use ExponentialStartStrategy along with the passed StartOption\(s\) when using the Client.Run method.

<a name="WithGracefulShutdownPeriod"></a>
### func [WithGracefulShutdownPeriod](https://github.com/gojek/courier-go/blob/main/client_options.go#L177)

```go
func WithGracefulShutdownPeriod(duration time.Duration) ClientOption
```

WithGracefulShutdownPeriod sets the limit that is allowed for existing work to be completed.

<a name="WithKeepAlive"></a>
### func [WithKeepAlive](https://github.com/gojek/courier-go/blob/main/client_options.go#L144)

```go
func WithKeepAlive(duration time.Duration) ClientOption
```

WithKeepAlive will set the amount of time \(in seconds\) that the client should wait before sending a PING request to the broker. This will allow the client to know that a connection has not been lost with the server. Deprecated: Use KeepAlive instead.

<a name="WithLogger"></a>
### func [WithLogger](https://github.com/gojek/courier-go/blob/main/log.go#L10)

```go
func WithLogger(l Logger) ClientOption
```

WithLogger sets the Logger to use for the client.

<a name="WithMaintainOrder"></a>
### func [WithMaintainOrder](https://github.com/gojek/courier-go/blob/main/client_options.go#L78)

```go
func WithMaintainOrder(maintainOrder bool) ClientOption
```

WithMaintainOrder will set the message routing to guarantee order within each QoS level. By default, this value is true. If set to false \(recommended\), this flag indicates that messages can be delivered asynchronously from the client to the application and possibly arrive out of order. Specifically, the message handler is called in its own go routine. Note that setting this to true does not guarantee in\-order delivery \(this is subject to broker settings like "max\_inflight\_messages=1"\) and if true then MessageHandler callback must not block.

<a name="WithMaxReconnectInterval"></a>
### func [WithMaxReconnectInterval](https://github.com/gojek/courier-go/blob/main/client_options.go#L170)

```go
func WithMaxReconnectInterval(duration time.Duration) ClientOption
```

WithMaxReconnectInterval sets the maximum time that will be waited between reconnection attempts. when connection is lost

<a name="WithOnConnect"></a>
### func [WithOnConnect](https://github.com/gojek/courier-go/blob/main/client_options.go#L86)

```go
func WithOnConnect(handler OnConnectHandler) ClientOption
```

WithOnConnect will set the OnConnectHandler callback to be called when the client is connected. Both at initial connection time and upon automatic reconnect.

<a name="WithOnConnectionLost"></a>
### func [WithOnConnectionLost](https://github.com/gojek/courier-go/blob/main/client_options.go#L94)

```go
func WithOnConnectionLost(handler OnConnectionLostHandler) ClientOption
```

WithOnConnectionLost will set the OnConnectionLostHandler callback to be executed in the case where the client unexpectedly loses connection with the MQTT broker.

<a name="WithOnReconnect"></a>
### func [WithOnReconnect](https://github.com/gojek/courier-go/blob/main/client_options.go#L102)

```go
func WithOnReconnect(handler OnReconnectHandler) ClientOption
```

WithOnReconnect sets the OnReconnectHandler callback to be executed prior to the client attempting a reconnect to the MQTT broker.

<a name="WithPahoLogLevel"></a>
### func [WithPahoLogLevel](https://github.com/gojek/courier-go/blob/main/log.go#L13)

```go
func WithPahoLogLevel(level LogLevel) ClientOption
```

WithPahoLogLevel sets the log level for the underlying Paho MQTT client.

<a name="WithPassword"></a>
### func [WithPassword](https://github.com/gojek/courier-go/blob/main/client_options.go#L37)

```go
func WithPassword(password string) ClientOption
```

WithPassword sets the password to be used while connecting to an MQTT broker.

<a name="WithPersistence"></a>
### func [WithPersistence](https://github.com/gojek/courier-go/blob/main/client_options.go#L185)

```go
func WithPersistence(store Store) ClientOption
```

WithPersistence allows to configure the store to be used by broker Default persistence is in\-memory persistence with mqtt.MemoryStore

<a name="WithResolver"></a>
### func [WithResolver](https://github.com/gojek/courier-go/blob/main/client_resolver.go#L37)

```go
func WithResolver(resolver Resolver) ClientOption
```

WithResolver sets the specified Resolver.

<a name="WithTCPAddress"></a>
### func [WithTCPAddress](https://github.com/gojek/courier-go/blob/main/client_options.go#L113)

```go
func WithTCPAddress(host string, port uint16) ClientOption
```

WithTCPAddress sets the broker address to be used. Default values for hostname is "127.0.0.1" and for port is 1883.

Deprecated: This Option used to work with plain TCP connections, it's now possible to use TLS with WithAddress and WithTLS combination.

<a name="WithTLS"></a>
### func [WithTLS](https://github.com/gojek/courier-go/blob/main/client_options.go#L44)

```go
func WithTLS(tlsConfig *tls.Config) ClientOption
```

WithTLS sets the TLs configuration to be used while connecting to an MQTT broker.

<a name="WithUseBase64Decoder"></a>
### func [WithUseBase64Decoder](https://github.com/gojek/courier-go/blob/main/client_options.go#L199)

```go
func WithUseBase64Decoder() ClientOption
```

WithUseBase64Decoder configures a json decoder with a base64.StdEncoding wrapped decoder which decodes base64 encoded message bytes into the passed object.

<a name="WithUsername"></a>
### func [WithUsername](https://github.com/gojek/courier-go/blob/main/client_options.go#L30)

```go
func WithUsername(username string) ClientOption
```

WithUsername sets the username to be used while connecting to an MQTT broker.

<a name="WithWriteTimeout"></a>
### func [WithWriteTimeout](https://github.com/gojek/courier-go/blob/main/client_options.go#L162)

```go
func WithWriteTimeout(duration time.Duration) ClientOption
```

WithWriteTimeout limits how long the client will wait when trying to publish, subscribe or unsubscribe on topic when a context deadline is not set while calling Publisher.Publish, Subscriber.Subscribe, Subscriber.SubscribeMultiple or Unsubscriber.Unsubscribe.

<a name="ConnectRetryInterval"></a>
## type [ConnectRetryInterval](https://github.com/gojek/courier-go/blob/main/client_options.go#L218)

ConnectRetryInterval allows to configure the interval between connection retries. Default value is 10 seconds.

```go
type ConnectRetryInterval time.Duration
```

<a name="ConnectionInformer"></a>
## type [ConnectionInformer](https://github.com/gojek/courier-go/blob/main/interface.go#L13-L16)

ConnectionInformer can be used to get information about the connection

```go
type ConnectionInformer interface {
    // IsConnected checks whether the client is connected to the broker
    IsConnected() bool
}
```

<a name="Credential"></a>
## type [Credential](https://github.com/gojek/courier-go/blob/main/client_credentials.go#L6-L9)

Credential is a \<username,password\> pair.

```go
type Credential struct {
    Username string
    Password string
}
```

<a name="CredentialFetcher"></a>
## type [CredentialFetcher](https://github.com/gojek/courier-go/blob/main/client_credentials.go#L12-L14)

CredentialFetcher is an interface that allows to fetch credentials for a client.

```go
type CredentialFetcher interface {
    Credentials(context.Context) (*Credential, error)
}
```

<a name="Decoder"></a>
## type [Decoder](https://github.com/gojek/courier-go/blob/main/decoder.go#L16-L19)

Decoder helps to decode message bytes into the desired object

```go
type Decoder interface {
    // Decode decodes message bytes into the passed object
    Decode(v interface{}) error
}
```

<a name="DefaultDecoderFunc"></a>
### func [DefaultDecoderFunc](https://github.com/gojek/courier-go/blob/main/decoder.go#L22)

```go
func DefaultDecoderFunc(_ context.Context, r io.Reader) Decoder
```

DefaultDecoderFunc is a DecoderFunc that uses a json.Decoder as the Decoder.

<a name="DecoderFunc"></a>
## type [DecoderFunc](https://github.com/gojek/courier-go/blob/main/decoder.go#L13)

DecoderFunc is used to create a Decoder from io.Reader stream of message bytes before calling MessageHandler; the context.Context value may be used to select appropriate Decoder.

```go
type DecoderFunc func(context.Context, io.Reader) Decoder
```

<a name="Encoder"></a>
## type [Encoder](https://github.com/gojek/courier-go/blob/main/encoder.go#L14-L17)

Encoder helps in transforming objects to message bytes

```go
type Encoder interface {
    // Encode takes any object and encodes it into bytes
    Encode(v interface{}) error
}
```

<a name="DefaultEncoderFunc"></a>
### func [DefaultEncoderFunc](https://github.com/gojek/courier-go/blob/main/encoder.go#L20)

```go
func DefaultEncoderFunc(_ context.Context, w io.Writer) Encoder
```

DefaultEncoderFunc is a EncoderFunc that uses a json.Encoder as the Encoder.

<a name="EncoderFunc"></a>
## type [EncoderFunc](https://github.com/gojek/courier-go/blob/main/encoder.go#L11)

EncoderFunc is used to create an Encoder from io.Writer; the context.Context value may be used to select appropriate Encoder.

```go
type EncoderFunc func(context.Context, io.Writer) Encoder
```

<a name="KeepAlive"></a>
## type [KeepAlive](https://github.com/gojek/courier-go/blob/main/client_options.go#L135)

KeepAlive will set the amount of time that the client should wait before sending a PING request to the broker. This will allow the client to know that a connection has not been lost with the server. Default value is 60 seconds. Note: Practically, when KeepAlive \>= 10s, the client will check every 5s, if it needs to send a PING. In other cases, the client will check every KeepAlive/2.

```go
type KeepAlive time.Duration
```

<a name="LogLevel"></a>
## type [LogLevel](https://github.com/gojek/courier-go/blob/main/log.go#L32)



```go
type LogLevel int
```

<a name="LogLevelDefault"></a>

```go
const (
    LogLevelDefault LogLevel = iota // LogLevelDefault disables all log output
    LogLevelDebug
    LogLevelWarn
    LogLevelError
)
```

<a name="Logger"></a>
## type [Logger](https://github.com/gojek/courier-go/blob/main/log.go#L20-L23)

Logger is the interface that wraps the Info and Error methods.

```go
type Logger interface {
    Info(ctx context.Context, msg string, attrs map[string]any)
    Error(ctx context.Context, err error, attrs map[string]any)
}
```

<a name="MQTTClientInfo"></a>
## type [MQTTClientInfo](https://github.com/gojek/courier-go/blob/main/client_telemetry.go#L14-L25)

MQTTClientInfo contains information about the internal MQTT client

```go
type MQTTClientInfo struct {
    Addresses     []TCPAddress `json:"addresses"`
    ClientID      string       `json:"client_id"`
    Username      string       `json:"username"`
    ResumeSubs    bool         `json:"resume_subs"`
    CleanSession  bool         `json:"clean_session"`
    AutoReconnect bool         `json:"auto_reconnect"`
    Connected     bool         `json:"connected"`
    // Subscriptions contains the topics the client is subscribed to
    // Note: Currently, this field only holds shared subscriptions.
    Subscriptions []string `json:"subscriptions,omitempty"`
}
```

<a name="Message"></a>
## type [Message](https://github.com/gojek/courier-go/blob/main/message.go#L4-L12)

Message represents the entity that is being relayed via the courier MQTT brokers from Publisher\(s\) to Subscriber\(s\).

```go
type Message struct {
    ID        int
    Topic     string
    Duplicate bool
    Retained  bool
    QoS       QOSLevel
    // contains filtered or unexported fields
}
```

<a name="NewMessageWithDecoder"></a>
### func [NewMessageWithDecoder](https://github.com/gojek/courier-go/blob/main/message.go#L15-L17)

```go
func NewMessageWithDecoder(payloadDecoder Decoder) *Message
```

NewMessageWithDecoder is a helper to create Message, ideally payloadDecoder should not be mutated once created.

<a name="Message.DecodePayload"></a>
### func \(\*Message\) [DecodePayload](https://github.com/gojek/courier-go/blob/main/message.go#L24)

```go
func (m *Message) DecodePayload(v interface{}) error
```

DecodePayload can decode the message payload bytes into the desired object.

<a name="MessageHandler"></a>
## type [MessageHandler](https://github.com/gojek/courier-go/blob/main/types.go#L24)

MessageHandler is the type that all callbacks being passed to Subscriber must satisfy.

```go
type MessageHandler func(context.Context, PubSub, *Message)
```

<a name="OnConnectHandler"></a>
## type [OnConnectHandler](https://github.com/gojek/courier-go/blob/main/types.go#L10)

OnConnectHandler is a callback that is called when the client state changes from disconnected to connected. Both at initial connection and on reconnection

```go
type OnConnectHandler func(PubSub)
```

<a name="OnConnectionLostHandler"></a>
## type [OnConnectionLostHandler](https://github.com/gojek/courier-go/blob/main/types.go#L16)

OnConnectionLostHandler is a callback type which can be set to be executed upon an unintended disconnection from the MQTT broker. Disconnects caused by calling Disconnect or ForceDisconnect will not cause an WithOnConnectionLost callback to execute.

```go
type OnConnectionLostHandler func(error)
```

<a name="OnReconnectHandler"></a>
## type [OnReconnectHandler](https://github.com/gojek/courier-go/blob/main/types.go#L20)

OnReconnectHandler is invoked prior to reconnecting after the initial connection is lost

```go
type OnReconnectHandler func(PubSub)
```

<a name="Option"></a>
## type [Option](https://github.com/gojek/courier-go/blob/main/options.go#L4-L6)

Option changes behaviour of Publisher.Publish, Subscriber.Subscribe calls.

```go
type Option interface {
    // contains filtered or unexported methods
}
```

<a name="PubSub"></a>
## type [PubSub](https://github.com/gojek/courier-go/blob/main/interface.go#L5-L10)

PubSub exposes all the operational functionalities of Client with Publisher, Subscriber, Unsubscriber and ConnectionInformer

```go
type PubSub interface {
    Publisher
    Subscriber
    Unsubscriber
    ConnectionInformer
}
```

<a name="Publisher"></a>
## type [Publisher](https://github.com/gojek/courier-go/blob/main/publisher.go#L8-L11)

Publisher defines behaviour of an MQTT publisher that can send messages.

```go
type Publisher interface {
    // Publish allows to publish messages to an MQTT broker
    Publish(ctx context.Context, topic string, message interface{}, options ...Option) error
}
```

<a name="PublisherFunc"></a>
## type [PublisherFunc](https://github.com/gojek/courier-go/blob/main/publisher.go#L14)

PublisherFunc defines signature of a Publish function.

```go
type PublisherFunc func(context.Context, string, interface{}, ...Option) error
```

<a name="PublisherFunc.Publish"></a>
### func \(PublisherFunc\) [Publish](https://github.com/gojek/courier-go/blob/main/publisher.go#L17-L22)

```go
func (f PublisherFunc) Publish(ctx context.Context, topic string, message interface{}, opts ...Option) error
```

Publish implements Publisher interface on PublisherFunc.

<a name="PublisherMiddlewareFunc"></a>
## type [PublisherMiddlewareFunc](https://github.com/gojek/courier-go/blob/main/publisher.go#L32)

PublisherMiddlewareFunc functions are closures that intercept Publisher.Publish calls.

```go
type PublisherMiddlewareFunc func(Publisher) Publisher
```

<a name="PublisherMiddlewareFunc.Middleware"></a>
### func \(PublisherMiddlewareFunc\) [Middleware](https://github.com/gojek/courier-go/blob/main/publisher.go#L35)

```go
func (pmw PublisherMiddlewareFunc) Middleware(publisher Publisher) Publisher
```

Middleware allows PublisherMiddlewareFunc to implement the publishMiddleware interface.

<a name="QOSLevel"></a>
## type [QOSLevel](https://github.com/gojek/courier-go/blob/main/options.go#L10)

QOSLevel is an agreement between the sender of a message and the receiver of a message that defines the guarantee of delivery for a specific message

```go
type QOSLevel uint8
```

<a name="QOSZero"></a>

```go
const (
    // QOSZero denotes at most once message delivery
    QOSZero QOSLevel = 0
    // QOSOne denotes at least once message delivery
    QOSOne QOSLevel = 1
    // QOSTwo denotes exactly once message delivery
    QOSTwo QOSLevel = 2
)
```

<a name="Resolver"></a>
## type [Resolver](https://github.com/gojek/courier-go/blob/main/client_resolver.go#L29-L34)

Resolver sends TCPAddress updates on channel returned by UpdateChan\(\) channel.

```go
type Resolver interface {
    // UpdateChan returns a channel where TCPAddress updates can be received.
    UpdateChan() <-chan []TCPAddress
    // Done returns a channel which is closed when the Resolver is no longer running.
    Done() <-chan struct{}
}
```

<a name="Retained"></a>
## type [Retained](https://github.com/gojek/courier-go/blob/main/options.go#L26)

Retained is an option used with Publisher.Publish call

```go
type Retained bool
```

<a name="SharedSubscriptionPredicate"></a>
## type [SharedSubscriptionPredicate](https://github.com/gojek/courier-go/blob/main/client_options.go#L227)

SharedSubscriptionPredicate allows to configure the predicate function that determines whether a topic is a shared subscription topic.

```go
type SharedSubscriptionPredicate func(topic string) bool
```

<a name="StartOption"></a>
## type [StartOption](https://github.com/gojek/courier-go/blob/main/exp_starter.go#L9)

StartOption can be used to customise behaviour of ExponentialStartStrategy

```go
type StartOption func(*startOptions)
```

<a name="WithMaxInterval"></a>
### func [WithMaxInterval](https://github.com/gojek/courier-go/blob/main/exp_starter.go#L13)

```go
func WithMaxInterval(interval time.Duration) StartOption
```

WithMaxInterval sets the maximum interval the retry logic will wait before attempting another Client.Start, Default is 30 seconds

<a name="WithOnRetry"></a>
### func [WithOnRetry](https://github.com/gojek/courier-go/blob/main/exp_starter.go#L23)

```go
func WithOnRetry(retryFunc func(error)) StartOption
```

WithOnRetry sets the func which is called when there is an error in the previous Client.Start attempt

<a name="Store"></a>
## type [Store](https://github.com/gojek/courier-go/blob/main/alias.go#L16)

Store is an interface which can be used to provide implementations for message persistence.

\[IMPORTANT\] When implementing a store with a shared storage \(ex: redis\) across multiple application instances, it should be ensured that the keys are namespaced for each application instance otherwise there will be collisions. The messages are identified based on message id from the MQTT packets, and they have values in range \(0, 2^16\), this coincides with max number of in\-flight messages

```go
type Store = mqtt.Store
```

<a name="NewMemoryStore"></a>
### func [NewMemoryStore](https://github.com/gojek/courier-go/blob/main/alias.go#L21)

```go
func NewMemoryStore() Store
```

NewMemoryStore returns a pointer to a new instance of mqtt.MemoryStore, the instance is not initialized and ready to use until Open\(\) has been called on it.

<a name="Subscriber"></a>
## type [Subscriber](https://github.com/gojek/courier-go/blob/main/subscriber.go#L8-L14)

Subscriber defines behaviour of an MQTT subscriber that can create subscriptions.

```go
type Subscriber interface {
    // Subscribe allows to subscribe to messages from an MQTT broker
    Subscribe(ctx context.Context, topic string, callback MessageHandler, opts ...Option) error

    // SubscribeMultiple allows to subscribe to messages on multiple topics from an MQTT broker
    SubscribeMultiple(ctx context.Context, topicsWithQos map[string]QOSLevel, callback MessageHandler) error
}
```

<a name="SubscriberFuncs"></a>
## type [SubscriberFuncs](https://github.com/gojek/courier-go/blob/main/subscriber.go#L30-L33)

SubscriberFuncs defines signature of a Subscribe function.

```go
type SubscriberFuncs struct {
    // contains filtered or unexported fields
}
```

<a name="NewSubscriberFuncs"></a>
### func [NewSubscriberFuncs](https://github.com/gojek/courier-go/blob/main/subscriber.go#L36-L39)

```go
func NewSubscriberFuncs(subscribeFunc func(context.Context, string, MessageHandler, ...Option) error, subscribeMultipleFunc func(context.Context, map[string]QOSLevel, MessageHandler) error) SubscriberFuncs
```

NewSubscriberFuncs is a helper function to create SubscriberFuncs

<a name="SubscriberFuncs.Subscribe"></a>
### func \(SubscriberFuncs\) [Subscribe](https://github.com/gojek/courier-go/blob/main/subscriber.go#L44)

```go
func (s SubscriberFuncs) Subscribe(ctx context.Context, topic string, callback MessageHandler, opts ...Option) error
```

Subscribe implements Subscriber interface on SubscriberFuncs.

<a name="SubscriberFuncs.SubscribeMultiple"></a>
### func \(SubscriberFuncs\) [SubscribeMultiple](https://github.com/gojek/courier-go/blob/main/subscriber.go#L49-L53)

```go
func (s SubscriberFuncs) SubscribeMultiple(ctx context.Context, topicsWithQos map[string]QOSLevel, callback MessageHandler) error
```

SubscribeMultiple implements Subscriber interface on SubscriberFuncs.

<a name="SubscriberMiddlewareFunc"></a>
## type [SubscriberMiddlewareFunc](https://github.com/gojek/courier-go/blob/main/subscriber.go#L22)

SubscriberMiddlewareFunc functions are closures that intercept Subscriber.Subscribe calls.

```go
type SubscriberMiddlewareFunc func(Subscriber) Subscriber
```

<a name="SubscriberMiddlewareFunc.Middleware"></a>
### func \(SubscriberMiddlewareFunc\) [Middleware](https://github.com/gojek/courier-go/blob/main/subscriber.go#L25)

```go
func (smw SubscriberMiddlewareFunc) Middleware(subscriber Subscriber) Subscriber
```

Middleware allows SubscriberMiddlewareFunc to implement the subscribeMiddleware interface.

<a name="TCPAddress"></a>
## type [TCPAddress](https://github.com/gojek/courier-go/blob/main/client_resolver.go#L21-L24)

TCPAddress specifies Host and Port for remote broker

```go
type TCPAddress struct {
    Host string `json:"host"`
    Port uint16 `json:"port"`
}
```

<a name="TCPAddress.String"></a>
### func \(TCPAddress\) [String](https://github.com/gojek/courier-go/blob/main/client_resolver.go#L26)

```go
func (t TCPAddress) String() string
```



<a name="Unsubscriber"></a>
## type [Unsubscriber](https://github.com/gojek/courier-go/blob/main/unsubscriber.go#L8-L11)

Unsubscriber defines behaviour of an MQTT client that can remove subscriptions.

```go
type Unsubscriber interface {
    // Unsubscribe removes any subscription to messages from an MQTT broker
    Unsubscribe(ctx context.Context, topics ...string) error
}
```

<a name="UnsubscriberFunc"></a>
## type [UnsubscriberFunc](https://github.com/gojek/courier-go/blob/main/unsubscriber.go#L27)

UnsubscriberFunc defines signature of a Unsubscribe function.

```go
type UnsubscriberFunc func(context.Context, ...string) error
```

<a name="UnsubscriberFunc.Unsubscribe"></a>
### func \(UnsubscriberFunc\) [Unsubscribe](https://github.com/gojek/courier-go/blob/main/unsubscriber.go#L30)

```go
func (f UnsubscriberFunc) Unsubscribe(ctx context.Context, topics ...string) error
```

Unsubscribe implements Unsubscriber interface on UnsubscriberFunc.

<a name="UnsubscriberMiddlewareFunc"></a>
## type [UnsubscriberMiddlewareFunc](https://github.com/gojek/courier-go/blob/main/unsubscriber.go#L19)

UnsubscriberMiddlewareFunc functions are closures that intercept Unsubscriber.Unsubscribe calls.

```go
type UnsubscriberMiddlewareFunc func(Unsubscriber) Unsubscriber
```

<a name="UnsubscriberMiddlewareFunc.Middleware"></a>
### func \(UnsubscriberMiddlewareFunc\) [Middleware](https://github.com/gojek/courier-go/blob/main/unsubscriber.go#L22)

```go
func (usmw UnsubscriberMiddlewareFunc) Middleware(unsubscriber Unsubscriber) Unsubscriber
```

Middleware allows UnsubscriberMiddlewareFunc to implement the unsubscribeMiddleware interface.

Generated by [gomarkdoc](https://github.com/princjef/gomarkdoc)
