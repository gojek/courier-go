<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# otelcourier

```go
import "github.com/gojek/courier-go/otelcourier"
```

Package otelcourier instruments the github.com/gojek/courier\-go package.

## Index

- [Constants](#constants)
- [Variables](#variables)
- [func DefaultTopicAttributeTransformer\(\_ context.Context, topic string\) string](#DefaultTopicAttributeTransformer)
- [type BucketBoundaries](#BucketBoundaries)
- [type CourierConfig](#CourierConfig)
- [type OTel](#OTel)
  - [func New\(service string, opts ...Option\) \*OTel](#New)
  - [func \(t \*OTel\) ApplyMiddlewares\(c UseMiddleware\)](#OTel.ApplyMiddlewares)
  - [func \(t \*OTel\) Meter\(\) metric.Meter](#OTel.Meter)
  - [func \(t \*OTel\) PublisherMiddleware\(next courier.Publisher\) courier.Publisher](#OTel.PublisherMiddleware)
  - [func \(t \*OTel\) Service\(\) string](#OTel.Service)
  - [func \(t \*OTel\) Stop\(\) error](#OTel.Stop)
  - [func \(t \*OTel\) StopMiddleware\(next courier.Stopper\) courier.Stopper](#OTel.StopMiddleware)
  - [func \(t \*OTel\) SubscriberMiddleware\(next courier.Subscriber\) courier.Subscriber](#OTel.SubscriberMiddleware)
  - [func \(t \*OTel\) UnsubscriberMiddleware\(next courier.Unsubscriber\) courier.Unsubscriber](#OTel.UnsubscriberMiddleware)
- [type Option](#Option)
  - [func WithAttributes\(attrs ...attribute.KeyValue\) Option](#WithAttributes)
  - [func WithInfoHandlerFrom\(c interface\{ InfoHandler\(\) http.Handler \}\) Option](#WithInfoHandlerFrom)
  - [func WithMeterProvider\(provider metric.MeterProvider\) Option](#WithMeterProvider)
  - [func WithTextMapCarrierExtractFunc\(fn func\(context.Context\) propagation.TextMapCarrier\) Option](#WithTextMapCarrierExtractFunc)
  - [func WithTextMapPropagator\(propagator propagation.TextMapPropagator\) Option](#WithTextMapPropagator)
  - [func WithTracerProvider\(provider oteltrace.TracerProvider\) Option](#WithTracerProvider)
- [type TopicAttributeTransformer](#TopicAttributeTransformer)
- [type UseMiddleware](#UseMiddleware)


## Constants

<a name="MQTTTopic"></a>

```go
const (
    // MQTTTopic is the attribute key for tracing message topic
    MQTTTopic = attribute.Key("mqtt.topic")
    // MQTTQoS is the attribute key for tracing message qos
    MQTTQoS = attribute.Key("mqtt.qos")
    // MQTTTopicWithQoS is the attribute key for tracing message topic and qos together
    MQTTTopicWithQoS = attribute.Key("mqtt.topicwithqos")
    // MQTTRetained is the attribute key for tracing message retained flag
    MQTTRetained = attribute.Key("mqtt.retained")
    // MQTTClientID is the attribute key for tracing mqtt client id
    MQTTClientID = attribute.Key("mqtt.clientid")
)
```

## Variables

<a name="DisableCallbackTracing"></a>DisableCallbackTracing disables implicit tracing on subscription callbacks.

```go
var DisableCallbackTracing = &disableTracePathOpt{traceCallback}
```

<a name="DisablePublisherTracing"></a>DisablePublisherTracing disables courier.Publisher tracing.

```go
var DisablePublisherTracing = &disableTracePathOpt{tracePublisher}
```

<a name="DisableSubscriberTracing"></a>DisableSubscriberTracing disables courier.Subscriber tracing.

```go
var DisableSubscriberTracing = &disableTracePathOpt{traceSubscriber}
```

<a name="DisableUnsubscriberTracing"></a>DisableUnsubscriberTracing disables courier.Unsubscriber tracing.

```go
var DisableUnsubscriberTracing = &disableTracePathOpt{traceUnsubscriber}
```

<a name="DefaultTopicAttributeTransformer"></a>
## func [DefaultTopicAttributeTransformer](https://github.com/gojek/courier-go/blob/main/otelcourier/options.go#L69)

```go
func DefaultTopicAttributeTransformer(_ context.Context, topic string) string
```

DefaultTopicAttributeTransformer is the default transformer for topic attribute.

<a name="BucketBoundaries"></a>
## type [BucketBoundaries](https://github.com/gojek/courier-go/blob/main/otelcourier/options.go#L72-L74)

BucketBoundaries helps override default histogram bucket boundaries for metrics.

```go
type BucketBoundaries struct {
    Publisher, Subscriber, Unsubscriber, Callback []float64
}
```

<a name="CourierConfig"></a>
## type [CourierConfig](https://github.com/gojek/courier-go/blob/main/otelcourier/metric.go#L153-L158)



```go
type CourierConfig interface {
    ConnectTimeout() time.Duration
    WriteTimeout() time.Duration
    KeepAlive() time.Duration
    AckTimeout() time.Duration
}
```

<a name="OTel"></a>
## type [OTel](https://github.com/gojek/courier-go/blob/main/otelcourier/otel.go#L31-L45)

OTel implements tracing & metric abilities using OpenTelemetry SDK.

```go
type OTel struct {
    // contains filtered or unexported fields
}
```

<a name="New"></a>
### func [New](https://github.com/gojek/courier-go/blob/main/otelcourier/otel.go#L48)

```go
func New(service string, opts ...Option) *OTel
```

New creates a new OTel with Option\(s\).

<details><summary>Example</summary>
<p>



```go
tp := trace.NewTracerProvider()
defer tp.Shutdown(context.Background())

exporter, err := prometheus.New(
/* Add a non-default prometheus registry here with `prometheus.WithRegisterer` option, if needed. */
)
if err != nil {
	panic(err)
}
mp := metric.NewMeterProvider(metric.WithReader(exporter))

otel.SetTracerProvider(tp)
otel.SetMeterProvider(mp)
otel.SetTextMapPropagator(&propagation.TraceContext{})

metricLabelMapper := otelcourier.TopicAttributeTransformer(func(ctx context.Context, topic string) string {
	if strings.HasPrefix(topic, "test") {
		return "test"
	}

	return "other"
})

c, _ := courier.NewClient()
otelcourier.New(
	"service-name",
	// Use this to also track active connections.
	otelcourier.WithInfoHandlerFrom(c),
	metricLabelMapper,
).ApplyMiddlewares(c)

if err := c.Start(); err != nil {
	panic(err)
}

ctx, _ := signal.NotifyContext(context.Background(), os.Interrupt, os.Kill)

if err := c.Publish(
	context.Background(), "test-topic", "message", courier.QOSOne); err != nil {
	panic(err)
}

if err := c.Publish(
	context.Background(), "other-topic", "message", courier.QOSOne); err != nil {
	panic(err)
}

// Here, you can expose the metrics at /metrics endpoint for prometheus.DefaultRegisterer.

<-ctx.Done()

c.Stop()
```

</p>
</details>

<a name="OTel.ApplyMiddlewares"></a>
### func \(\*OTel\) [ApplyMiddlewares](https://github.com/gojek/courier-go/blob/main/otelcourier/otel.go#L86)

```go
func (t *OTel) ApplyMiddlewares(c UseMiddleware)
```

ApplyMiddlewares will instrument all the operations of a UseMiddleware instance according to Option\(s\) used.

<a name="OTel.Meter"></a>
### func \(\*OTel\) [Meter](https://github.com/gojek/courier-go/blob/main/otelcourier/otel.go#L106)

```go
func (t *OTel) Meter() metric.Meter
```



<a name="OTel.PublisherMiddleware"></a>
### func \(\*OTel\) [PublisherMiddleware](https://github.com/gojek/courier-go/blob/main/otelcourier/publish.go#L23)

```go
func (t *OTel) PublisherMiddleware(next courier.Publisher) courier.Publisher
```

PublisherMiddleware is a courier.PublisherMiddlewareFunc for tracing publish calls.

<a name="OTel.Service"></a>
### func \(\*OTel\) [Service](https://github.com/gojek/courier-go/blob/main/otelcourier/otel.go#L110)

```go
func (t *OTel) Service() string
```



<a name="OTel.Stop"></a>
### func \(\*OTel\) [Stop](https://github.com/gojek/courier-go/blob/main/otelcourier/stop.go#L6)

```go
func (t *OTel) Stop() error
```

Stop implements the courier.Stopper interface to unregister any handlers or clean up resources.

<a name="OTel.StopMiddleware"></a>
### func \(\*OTel\) [StopMiddleware](https://github.com/gojek/courier-go/blob/main/otelcourier/stop.go#L19)

```go
func (t *OTel) StopMiddleware(next courier.Stopper) courier.Stopper
```

StopMiddleware returns a Stopper middleware that ensures OTel async metric is unregistered when the client stops.

<a name="OTel.SubscriberMiddleware"></a>
### func \(\*OTel\) [SubscriberMiddleware](https://github.com/gojek/courier-go/blob/main/otelcourier/subscribe.go#L43)

```go
func (t *OTel) SubscriberMiddleware(next courier.Subscriber) courier.Subscriber
```

SubscriberMiddleware is a courier.SubscriberMiddlewareFunc for tracing subscribe calls.

<a name="OTel.UnsubscriberMiddleware"></a>
### func \(\*OTel\) [UnsubscriberMiddleware](https://github.com/gojek/courier-go/blob/main/otelcourier/unsubscribe.go#L22)

```go
func (t *OTel) UnsubscriberMiddleware(next courier.Unsubscriber) courier.Unsubscriber
```

UnsubscriberMiddleware is a courier.UnsubscriberMiddlewareFunc for tracing unsubscribe calls.

<a name="Option"></a>
## type [Option](https://github.com/gojek/courier-go/blob/main/otelcourier/options.go#L15)

Option helps configure trace options.

```go
type Option interface {
    // contains filtered or unexported methods
}
```

<a name="WithAttributes"></a>
### func [WithAttributes](https://github.com/gojek/courier-go/blob/main/otelcourier/options.go#L52)

```go
func WithAttributes(attrs ...attribute.KeyValue) Option
```

WithAttributes adds custom attributes to all spans and metrics created.

<a name="WithInfoHandlerFrom"></a>
### func [WithInfoHandlerFrom](https://github.com/gojek/courier-go/blob/main/otelcourier/options.go#L47)

```go
func WithInfoHandlerFrom(c interface{ InfoHandler() http.Handler }) Option
```

WithInfoHandlerFrom is used to specify the handler which should be used to extract client information from the courier.Client instance.

<a name="WithMeterProvider"></a>
### func [WithMeterProvider](https://github.com/gojek/courier-go/blob/main/otelcourier/options.go#L29)

```go
func WithMeterProvider(provider metric.MeterProvider) Option
```

WithMeterProvider specifies a meter provider to use for creating a meter. If none is specified, the global provider is used.

<a name="WithTextMapCarrierExtractFunc"></a>
### func [WithTextMapCarrierExtractFunc](https://github.com/gojek/courier-go/blob/main/otelcourier/options.go#L41)

```go
func WithTextMapCarrierExtractFunc(fn func(context.Context) propagation.TextMapCarrier) Option
```

WithTextMapCarrierExtractFunc is used to specify the function which should be used to extract propagation.TextMapCarrier from the ongoing context.Context.

<a name="WithTextMapPropagator"></a>
### func [WithTextMapPropagator](https://github.com/gojek/courier-go/blob/main/otelcourier/options.go#L35)

```go
func WithTextMapPropagator(propagator propagation.TextMapPropagator) Option
```

WithTextMapPropagator specifies the propagator to use for extracting/injecting key\-value texts. If none is specified, the global provider is used.

<a name="WithTracerProvider"></a>
### func [WithTracerProvider](https://github.com/gojek/courier-go/blob/main/otelcourier/options.go#L23)

```go
func WithTracerProvider(provider oteltrace.TracerProvider) Option
```

WithTracerProvider specifies a tracer provider to use for creating a tracer. If none is specified, the global provider is used.

<a name="TopicAttributeTransformer"></a>
## type [TopicAttributeTransformer](https://github.com/gojek/courier-go/blob/main/otelcourier/options.go#L19)

TopicAttributeTransformer helps transform topic before making an attribute for it. It is used in metric recording only. Traces use the original topic.

```go
type TopicAttributeTransformer func(context.Context, string) string
```

<a name="UseMiddleware"></a>
## type [UseMiddleware](https://github.com/gojek/courier-go/blob/main/otelcourier/otel.go#L23-L28)

UseMiddleware is an interface that defines the methods to apply middlewares to a courier.Client or similar instance.

```go
type UseMiddleware interface {
    UsePublisherMiddleware(mwf ...courier.PublisherMiddlewareFunc)
    UseSubscriberMiddleware(mwf ...courier.SubscriberMiddlewareFunc)
    UseUnsubscriberMiddleware(mwf ...courier.UnsubscriberMiddlewareFunc)
    UseStopMiddleware(mwf courier.StopMiddlewareFunc)
}
```

Generated by [gomarkdoc](https://github.com/princjef/gomarkdoc)
