<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# otelcourier

```go
import "github.com/gojek/courier-go/otelcourier"
```

Package otelcourier instruments the github.com/gojek/courier\-go package.

## Index

- [Constants](#constants)
- [Variables](#variables)
- [func DefaultTopicAttributeTransformer\(\_ context.Context, topic string\) string](#DefaultTopicAttributeTransformer)
- [type OTel](#OTel)
  - [func New\(service string, opts ...Option\) \*OTel](#New)
  - [func \(t \*OTel\) ApplyMiddlewares\(c UseMiddleware\)](#OTel.ApplyMiddlewares)
  - [func \(t \*OTel\) Emit\(\_ context.Context, meta courier.ClientMeta\)](#OTel.Emit)
  - [func \(t \*OTel\) PublisherMiddleware\(next courier.Publisher\) courier.Publisher](#OTel.PublisherMiddleware)
  - [func \(t \*OTel\) SubscriberMiddleware\(next courier.Subscriber\) courier.Subscriber](#OTel.SubscriberMiddleware)
  - [func \(t \*OTel\) UnsubscriberMiddleware\(next courier.Unsubscriber\) courier.Unsubscriber](#OTel.UnsubscriberMiddleware)
- [type Option](#Option)
  - [func WithMeterProvider\(provider metric.MeterProvider\) Option](#WithMeterProvider)
  - [func WithTextMapCarrierExtractFunc\(fn func\(context.Context\) propagation.TextMapCarrier\) Option](#WithTextMapCarrierExtractFunc)
  - [func WithTextMapPropagator\(propagator propagation.TextMapPropagator\) Option](#WithTextMapPropagator)
  - [func WithTracerProvider\(provider oteltrace.TracerProvider\) Option](#WithTracerProvider)
- [type TopicAttributeTransformer](#TopicAttributeTransformer)
- [type UseMiddleware](#UseMiddleware)


## Constants

<a name="MQTTTopic"></a>

```go
const (
    // MQTTTopic is the attribute key for tracing message topic
    MQTTTopic = attribute.Key("mqtt.topic")
    // MQTTQoS is the attribute key for tracing message qos
    MQTTQoS = attribute.Key("mqtt.qos")
    // MQTTTopicWithQoS is the attribute key for tracing message topic and qos together
    MQTTTopicWithQoS = attribute.Key("mqtt.topicwithqos")
    // MQTTRetained is the attribute key for tracing message retained flag
    MQTTRetained = attribute.Key("mqtt.retained")
    // MQTTClientID is the attribute key for tracing mqtt client id
    MQTTClientID = attribute.Key("mqtt.clientid")
    // CallbackName is the attribute key for tracing message handler function name
    CallbackName = attribute.Key("callback.name")
)
```

## Variables

<a name="DisableCallbackTracing"></a>DisableCallbackTracing disables implicit tracing on subscription callbacks.

```go
var DisableCallbackTracing = &disableTracePathOpt{traceCallback}
```

<a name="DisablePublisherTracing"></a>DisablePublisherTracing disables courier.Publisher tracing.

```go
var DisablePublisherTracing = &disableTracePathOpt{tracePublisher}
```

<a name="DisableSubscriberTracing"></a>DisableSubscriberTracing disables courier.Subscriber tracing.

```go
var DisableSubscriberTracing = &disableTracePathOpt{traceSubscriber}
```

<a name="DisableUnsubscriberTracing"></a>DisableUnsubscriberTracing disables courier.Unsubscriber tracing.

```go
var DisableUnsubscriberTracing = &disableTracePathOpt{traceUnsubscriber}
```

<a name="DefaultTopicAttributeTransformer"></a>
## func [DefaultTopicAttributeTransformer](https://github.com/gojek/courier-go/blob/main/otelcourier/options.go#L56)

```go
func DefaultTopicAttributeTransformer(_ context.Context, topic string) string
```

DefaultTopicAttributeTransformer is the default transformer for topic attribute.

<a name="OTel"></a>
## type [OTel](https://github.com/gojek/courier-go/blob/main/otelcourier/otel.go#L28-L40)

OTel implements tracing & metric abilities using OpenTelemetry SDK.

```go
type OTel struct {
    // contains filtered or unexported fields
}
```

<a name="New"></a>
### func [New](https://github.com/gojek/courier-go/blob/main/otelcourier/otel.go#L43)

```go
func New(service string, opts ...Option) *OTel
```

New creates a new OTel with Option\(s\).

<details><summary>Example</summary>
<p>



```go
tp := trace.NewTracerProvider()
defer tp.Shutdown(context.Background())

exporter, err := prometheus.New(
/* Add a non-default prometheus registry here with `prometheus.WithRegisterer` option, if needed. */
)
if err != nil {
	panic(err)
}
mp := metric.NewMeterProvider(metric.WithReader(exporter))

otel.SetTracerProvider(tp)
otel.SetMeterProvider(mp)
otel.SetTextMapPropagator(&propagation.TraceContext{})

metricLabelMapper := otelcourier.TopicAttributeTransformer(func(ctx context.Context, topic string) string {
	if strings.HasPrefix(topic, "test") {
		return "test"
	}

	return "other"
})

c, _ := courier.NewClient()
otelcourier.New("service-name", metricLabelMapper).ApplyMiddlewares(c)

if err := c.Start(); err != nil {
	panic(err)
}

ctx, _ := signal.NotifyContext(context.Background(), os.Interrupt, os.Kill)

if err := c.Publish(
	context.Background(), "test-topic", "message", courier.QOSOne); err != nil {
	panic(err)
}

if err := c.Publish(
	context.Background(), "other-topic", "message", courier.QOSOne); err != nil {
	panic(err)
}

// Here, you can expose the metrics at /metrics endpoint for prometheus.DefaultRegisterer.

<-ctx.Done()

c.Stop()
```

</p>
</details>

<a name="OTel.ApplyMiddlewares"></a>
### func \(\*OTel\) [ApplyMiddlewares](https://github.com/gojek/courier-go/blob/main/otelcourier/otel.go#L80)

```go
func (t *OTel) ApplyMiddlewares(c UseMiddleware)
```

ApplyMiddlewares will instrument all the operations of a UseMiddleware instance according to Option\(s\) used.

<a name="OTel.Emit"></a>
### func \(\*OTel\) [Emit](https://github.com/gojek/courier-go/blob/main/otelcourier/emitter.go#L39)

```go
func (t *OTel) Emit(_ context.Context, meta courier.ClientMeta)
```



<a name="OTel.PublisherMiddleware"></a>
### func \(\*OTel\) [PublisherMiddleware](https://github.com/gojek/courier-go/blob/main/otelcourier/publish.go#L23)

```go
func (t *OTel) PublisherMiddleware(next courier.Publisher) courier.Publisher
```

PublisherMiddleware is a courier.PublisherMiddlewareFunc for tracing publish calls.

<a name="OTel.SubscriberMiddleware"></a>
### func \(\*OTel\) [SubscriberMiddleware](https://github.com/gojek/courier-go/blob/main/otelcourier/subscribe.go#L41)

```go
func (t *OTel) SubscriberMiddleware(next courier.Subscriber) courier.Subscriber
```

SubscriberMiddleware is a courier.SubscriberMiddlewareFunc for tracing subscribe calls.

<a name="OTel.UnsubscriberMiddleware"></a>
### func \(\*OTel\) [UnsubscriberMiddleware](https://github.com/gojek/courier-go/blob/main/otelcourier/unsubscribe.go#L21)

```go
func (t *OTel) UnsubscriberMiddleware(next courier.Unsubscriber) courier.Unsubscriber
```

UnsubscriberMiddleware is a courier.UnsubscriberMiddlewareFunc for tracing unsubscribe calls.

<a name="Option"></a>
## type [Option](https://github.com/gojek/courier-go/blob/main/otelcourier/options.go#L13)

Option helps configure trace options.

```go
type Option interface {
    // contains filtered or unexported methods
}
```

<a name="WithMeterProvider"></a>
### func [WithMeterProvider](https://github.com/gojek/courier-go/blob/main/otelcourier/options.go#L27)

```go
func WithMeterProvider(provider metric.MeterProvider) Option
```

WithMeterProvider specifies a meter provider to use for creating a meter. If none is specified, the global provider is used.

<a name="WithTextMapCarrierExtractFunc"></a>
### func [WithTextMapCarrierExtractFunc](https://github.com/gojek/courier-go/blob/main/otelcourier/options.go#L39)

```go
func WithTextMapCarrierExtractFunc(fn func(context.Context) propagation.TextMapCarrier) Option
```

WithTextMapCarrierExtractFunc is used to specify the function which should be used to extract propagation.TextMapCarrier from the ongoing context.Context.

<a name="WithTextMapPropagator"></a>
### func [WithTextMapPropagator](https://github.com/gojek/courier-go/blob/main/otelcourier/options.go#L33)

```go
func WithTextMapPropagator(propagator propagation.TextMapPropagator) Option
```

WithTextMapPropagator specifies the propagator to use for extracting/injecting key\-value texts. If none is specified, the global provider is used.

<a name="WithTracerProvider"></a>
### func [WithTracerProvider](https://github.com/gojek/courier-go/blob/main/otelcourier/options.go#L21)

```go
func WithTracerProvider(provider oteltrace.TracerProvider) Option
```

WithTracerProvider specifies a tracer provider to use for creating a tracer. If none is specified, the global provider is used.

<a name="TopicAttributeTransformer"></a>
## type [TopicAttributeTransformer](https://github.com/gojek/courier-go/blob/main/otelcourier/options.go#L17)

TopicAttributeTransformer helps transform topic before making an attribute for it. It is used in metric recording only. Traces use the original topic.

```go
type TopicAttributeTransformer func(context.Context, string) string
```

<a name="UseMiddleware"></a>
## type [UseMiddleware](https://github.com/gojek/courier-go/blob/main/otelcourier/otel.go#L21-L25)

UseMiddleware is an interface that defines the methods to apply middlewares to a courier.Client or similar instance.

```go
type UseMiddleware interface {
    UsePublisherMiddleware(mwf ...courier.PublisherMiddlewareFunc)
    UseSubscriberMiddleware(mwf ...courier.SubscriberMiddlewareFunc)
    UseUnsubscriberMiddleware(mwf ...courier.UnsubscriberMiddlewareFunc)
}
```

Generated by [gomarkdoc](https://github.com/princjef/gomarkdoc)
